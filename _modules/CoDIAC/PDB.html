<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CoDIAC.PDB &#8212; CoDIAC 1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=def86cc0" />
    
    <script src="../../_static/documentation_options.js?v=29a6c3e3"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CoDIAC 1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">CoDIAC.PDB</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for CoDIAC.PDB</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PDB_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ENTITY_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CHAIN_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;pdbx_description&#39;</span><span class="p">,</span>  <span class="s1">&#39;rcsb_gene_name&#39;</span><span class="p">,</span> <span class="s1">&#39;pdbx_gene_src_scientific_name&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pdbx_seq_one_letter_code&#39;</span><span class="p">,</span> <span class="s1">&#39;pdbx_seq_one_letter_code_can&#39;</span><span class="p">,</span> <span class="s1">&#39;rcsb_sample_sequence_length&#39;</span><span class="p">,</span>
            <span class="s1">&#39;modifications locations&#39;</span><span class="p">,</span><span class="s1">&#39;modifications&#39;</span><span class="p">,</span>  <span class="s1">&#39;rcsb_entity_polymer_type&#39;</span><span class="p">,</span> <span class="s1">&#39;macromolecular_type&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;database_name&#39;</span><span class="p">,</span> <span class="s1">&#39;database_accession&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;rcsb_uniprot_protein_sequence&#39;</span><span class="p">,</span>  <span class="s1">&#39;entity_beg_seq_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ref_beg_seq_id&#39;</span><span class="p">,</span><span class="s1">&#39;aligned_regions_length&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mutations exist (Y/N)&#39;</span><span class="p">,</span><span class="s1">&#39;rcsb_mutation_count&#39;</span><span class="p">,</span><span class="s1">&#39;mutations locations&#39;</span><span class="p">,</span> <span class="s1">&#39;pdbx_mutation joined&#39;</span><span class="p">,</span>
            <span class="s1">&#39;molecular_weight&#39;</span><span class="p">,</span> <span class="s1">&#39;experimental_method&#39;</span><span class="p">,</span> <span class="s1">&#39;resolution_combined&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;deposit_date&#39;</span><span class="p">,</span> <span class="s1">&#39;audit_author_name&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;pdbx_database_id_doi&#39;</span><span class="p">,</span><span class="s1">&#39;pdbx_database_id_pub_med&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">PDB_interface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class that obtains and outputs relevant metadata/annotations for a PDB ID in the form of a dictionary</span>
<span class="sd">    and/or ability to write to a csv file.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    -----------</span>
<span class="sd">    PDB_list : list of strings</span>
<span class="sd">        list of PDB IDs (4-character alphanumeric identifier) that the user wants to gather information on</span>
<span class="sd">    </span>
<span class="sd">    Methods</span>
<span class="sd">    --------</span>
<span class="sd">    get_anno_dict</span>
<span class="sd">        Produces a dictionary full of the annotations for</span>
<span class="sd">         the PDB ID.</span>
<span class="sd">    print_output_csv</span>
<span class="sd">        Produces a csv file (to the location of the inputted file path) full of the annotations for all of the pdb ids</span>
<span class="sd">        from the inputted csv file.</span>
<span class="sd">    get_all</span>
<span class="sd">        Produces a dictionary, csv file, &amp; Excel file (to the location of the input file path) full of the annotations</span>
<span class="sd">        for all of the pdb ids from the inputted csv file.</span>
<span class="sd">    </span>
<span class="sd">	</span>
<span class="sd">	&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PDB_ID</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor for the PDB_interface class.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        PDB : list of strings</span>
<span class="sd">            PDB ID (4-character alphanumeric identifier) that the user wants to gather information on</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PDB_ID</span> <span class="o">=</span> <span class="n">PDB_ID</span>

       
    <span class="k">def</span> <span class="nf">get_anno_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produces a dictionary full of the annotations for all of the PDB IDs from the PDB List of IDs used to instantiate the object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ERROR: bool</span>
<span class="sd">            0 if no error, 1 if error</span>
<span class="sd">        annotated_dict_list : list of dictionaries</span>
<span class="sd">            list of each entitiy dictionary </span>
<span class="sd">            where the dictionary has PDB.COLUMNS keys and information for each entity</span>
<span class="sd">            list is empty if error</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#IDs = self.PDB_list</span>
        
        <span class="n">overall_dict</span> <span class="o">=</span> <span class="p">{}</span>
        
<span class="c1">#        for each_id in IDs:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ERROR</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PDB_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PDB_ID</span><span class="p">)</span>
            <span class="n">annotated_dict_list</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">set_PDB_API_annotation</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ERROR</span><span class="p">,</span> <span class="n">annotated_dict_list</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1">#print(self.PDB_ID + &#39; could not be fetched&#39;)</span>
            <span class="n">ERROR</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">ERROR</span><span class="p">,</span> <span class="p">[]</span>


    
    <span class="k">def</span> <span class="nf">print_output_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produces a csv file (to the location of the inputted file path) full of the annotations for all of the pdb ids</span>
<span class="sd">        from the inputted csv file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        outputFile : string</span>
<span class="sd">            name of the csv file you want to generate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ERROR</span><span class="p">,</span> <span class="n">overall_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anno_dict</span><span class="p">()</span>
        <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">each_key</span> <span class="ow">in</span> <span class="n">overall_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">each_entity</span> <span class="ow">in</span> <span class="n">overall_dict</span><span class="p">[</span><span class="n">each_key</span><span class="p">]:</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each_entity</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">COLUMNS</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">outputFile</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.csv&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outputFile</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">get_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produces a dictionary and csv file  full of the annotations</span>
<span class="sd">        for all of the pdb ids from the inputted csv file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        overall_dict : dictionary</span>
<span class="sd">            dictionary full of the annotations for all of the pdb ids from the inputted file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">csv_file_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter a file name for the output csv file: &#39;</span><span class="p">)</span>
        <span class="n">ERROR</span><span class="p">,</span> <span class="n">overall_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anno_dict</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">overall_dict</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_file_name</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">overall_dict</span>

    <span class="k">class</span> <span class="nc">PDB_metadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A class that stores relevant metadata for individual PDB IDs.</span>
<span class="sd">        </span>
<span class="sd">        Attributes</span>
<span class="sd">        -----------</span>
<span class="sd">        meta_data_categories : list</span>
<span class="sd">            A defined list of relevant metadata categories from PDB that this class will store</span>
<span class="sd">        PDB_ID : string</span>
<span class="sd">            the PDB ID (4-character alphanumeric identifier) that the user wants to gather information on</span>
<span class="sd">        entry_dict : dictionary</span>
<span class="sd">            stores information from the entry service for the PDB_ID</span>
<span class="sd">        overall_polymer_entity_dict : dictionary</span>
<span class="sd">            stores polymer entity data for each entity id corresponding with the PDB_ID</span>
<span class="sd">                        </span>
<span class="sd">        Methods</span>
<span class="sd">        --------</span>
<span class="sd">        set_PDB_API_annotation</span>
<span class="sd">            Utilizes other class methods to generate dictionaries of information for a PDB ID, find the correct information</span>
<span class="sd">            (&quot;value&quot;) for each attibute (&quot;key&quot;) for that PDB ID, and store the key-value pairs in a dictionary containing</span>
<span class="sd">            all the desired information for that PDB ID.</span>
<span class="sd">        get_empty_anno_dict</span>
<span class="sd">            Creates a dictionary with the attributes contained in meta_data as keys with empty values.</span>
<span class="sd">        get_all_dicts</span>
<span class="sd">            Obtains information from the PDB API for a specific PDB ID and stores it in dictionaries.</span>
<span class="sd">        get_annotation</span>
<span class="sd">            Finds and returns the corresponding information for the specified attribute of the PDB ID.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">meta_data_categories</span> <span class="o">=</span> <span class="n">COLUMNS</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PDB_ID</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Constructor for the PDB_metadata class which takes in a PDB ID and generates global metadata dictionaries for it.</span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            PDB_ID : string</span>
<span class="sd">                the PDB ID (4-character alphanumeric identifier) that the user wants to gather information on</span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            None.</span>

<span class="sd">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">PDB_ID</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">overall_polymer_entity_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_dicts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mods</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span> <span class="nf">set_PDB_API_annotation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Utilizes other class methods to generate dictionaries of information for a PDB ID, find the correct information</span>
<span class="sd">            (&quot;value&quot;) for each attibute (&quot;key&quot;) for that PDB ID, and store the key-value pairs in a dictionary containing</span>
<span class="sd">            all the desired information for that PDB ID.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            anno_dict_list : list of dictionaries</span>
<span class="sd">                dictionary storing all information for the PDB_ID</span>
<span class="sd">                list is returned since multipel entities can be present in a single PDB file with different attributes</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">anno_dict_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">entity_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_entry_container_identifiers&#39;</span><span class="p">][</span><span class="s1">&#39;polymer_entity_ids&#39;</span><span class="p">]:</span>
                <span class="n">anno_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_anno_dict</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
                <span class="n">anno_dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">anno_dict</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">anno_dict_list</span>

        <span class="k">def</span> <span class="nf">get_empty_anno_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates a dictionary with the attributes contained in meta_data as keys with empty values. </span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            inner : dictionary</span>
<span class="sd">                placeholder dictionary created before the values are added.</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">inner</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">meta_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_data_categories</span>
            <span class="k">for</span> <span class="n">meta</span> <span class="ow">in</span> <span class="n">meta_data</span><span class="p">:</span>
                <span class="n">inner</span><span class="p">[</span><span class="n">meta</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">return</span> <span class="n">inner</span>
        
        <span class="k">def</span> <span class="nf">return_anno_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polymer_entity_id</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Creates a dictionary with the attributes contained in meta_data as keys with empty values. </span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            anno_dict : dictionary</span>
<span class="sd">                updated anno_dict</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">anno_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_empty_anno_dict</span><span class="p">()</span>
            <span class="n">polymer_entity_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overall_polymer_entity_dict</span><span class="p">[</span><span class="n">polymer_entity_id</span><span class="p">]</span>


            <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;PDB_ID&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;ENTITY_ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer_entity_id</span>

            <span class="c1">#CHAIN ID</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">entity_poly</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;entity_poly&#39;</span><span class="p">]</span>
                    <span class="n">CHAIN_ID</span> <span class="o">=</span> <span class="n">entity_poly</span><span class="p">[</span><span class="s1">&#39;pdbx_strand_id&#39;</span><span class="p">]</span>
                    <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;CHAIN_ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CHAIN_ID</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;CHAIN_ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            <span class="c1">#database name</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">rcsb_container_identifiers</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_polymer_entity_container_identifiers&#39;</span><span class="p">]</span>
                    <span class="n">reference_sequence_identifiers</span> <span class="o">=</span> <span class="n">rcsb_container_identifiers</span><span class="p">[</span><span class="s1">&#39;reference_sequence_identifiers&#39;</span><span class="p">]</span>
                    <span class="n">middle</span> <span class="o">=</span> <span class="n">reference_sequence_identifiers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;database_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="s1">&#39;database_name&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;database_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>

            <span class="c1">#gene name</span>

            <span class="c1">#elif (attribute == &#39;rcsb_gene_name&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rcsb_gene_nameS_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">rcsb_entity_source_organism</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_entity_source_organism&#39;</span><span class="p">]</span>
                    <span class="n">middle</span> <span class="o">=</span> <span class="n">rcsb_entity_source_organism</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">rcsb_gene_name</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="s1">&#39;rcsb_gene_name&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">each_dict</span> <span class="ow">in</span> <span class="n">rcsb_gene_name</span><span class="p">:</span>
                        <span class="n">gene_name</span> <span class="o">=</span> <span class="n">each_dict</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">gene_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rcsb_gene_nameS_list</span><span class="p">:</span>
                            <span class="n">rcsb_gene_nameS_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gene_name</span><span class="p">)</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_gene_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rcsb_gene_nameS_list</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_gene_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
               

            <span class="c1">#elif (attribute == &#39;database_accession&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">rcsb_container_identifiers</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_polymer_entity_container_identifiers&#39;</span><span class="p">]</span>
                    <span class="n">reference_sequence_identifiers</span> <span class="o">=</span> <span class="n">rcsb_container_identifiers</span><span class="p">[</span><span class="s1">&#39;reference_sequence_identifiers&#39;</span><span class="p">]</span>
                    <span class="n">middle</span> <span class="o">=</span> <span class="n">reference_sequence_identifiers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;database_accession&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="s1">&#39;database_accession&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;database_accession&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>

            <span class="c1">#elif (attribute == &#39;pdbx_seq_one_letter_code&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pdbx_seq_one_letter_code</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">entity_poly</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;entity_poly&#39;</span><span class="p">]</span>
                    <span class="n">pdbx_seq_one_letter_code</span> <span class="o">=</span> <span class="n">entity_poly</span><span class="p">[</span><span class="s1">&#39;pdbx_seq_one_letter_code&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_seq_one_letter_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdbx_seq_one_letter_code</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_seq_one_letter_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            
            <span class="c1">#elif (attribute == &#39;rcsb_uniprot_protein_sequence&#39;):</span>
            <span class="n">entity_id</span> <span class="o">=</span>  <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;ENTITY_ID&#39;</span><span class="p">]</span>
            <span class="n">uniprot_url</span> <span class="o">=</span> <span class="s2">&quot;https://data.rcsb.org/rest/v1/core/uniprot/&quot;</span> <span class="o">+</span> \
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;PDB_ID&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">entity_id</span>
            <span class="c1">#print(&quot;DEBUG: %s&quot;%(uniprot_url))</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uniprot_url</span><span class="p">)</span>
            <span class="c1">#print(&quot;DEBUG: %s&quot;%(resp.status_code))</span>
            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1">#print(&#39;Failed to get %s from rcsb uniprot with code %s:&#39;%(PDB_ID, resp.status_code))</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_uniprot_protein_sequence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1">#in case we got a response, but it does not conform to json, try, except here</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">uniprot_entity_dict</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="n">SEQ</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uniprot_entity_dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="c1">#len(uniprot_entity_dict) &lt; 3:</span>
                        <span class="c1">#print(len(uniprot_entity_dict))</span>
                        <span class="n">middle</span> <span class="o">=</span> <span class="n">uniprot_entity_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">middle</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                            <span class="n">rcsb_uniprot_protein</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="s1">&#39;rcsb_uniprot_protein&#39;</span><span class="p">]</span>
                            <span class="n">SEQ</span> <span class="o">=</span> <span class="n">rcsb_uniprot_protein</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]</span>
                            <span class="c1">#print(SEQ)</span>
                            <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_uniprot_protein_sequence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SEQ</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_uniprot_protein_sequence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_uniprot_protein_sequence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            <span class="c1">#elif (attribute == &#39;rcsb_sample_sequence_length&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">entity_poly</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;entity_poly&#39;</span><span class="p">]</span>
                    <span class="n">sequence_length</span> <span class="o">=</span> <span class="n">entity_poly</span><span class="p">[</span><span class="s1">&#39;rcsb_sample_sequence_length&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_sample_sequence_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequence_length</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_sample_sequence_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            
            <span class="c1">#elif (attribute == &#39;rcsb_entity_polymer_type&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">entity_poly</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;entity_poly&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_entity_polymer_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity_poly</span><span class="p">[</span><span class="s1">&#39;rcsb_entity_polymer_type&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_entity_polymer_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            

            <span class="c1">#elif (attribute == &#39;macromolecular_type&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">entity_poly</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;entity_poly&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;macromolecular_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity_poly</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;macromolecular_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            <span class="c1">#elif (attribute == &#39;molecular_weight&#39;):</span>
            <span class="n">entry_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_entry_info&#39;</span><span class="p">]</span>
            <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;molecular_weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry_info</span><span class="p">[</span><span class="s1">&#39;molecular_weight&#39;</span><span class="p">]</span>

            <span class="c1">#elif (attribute == &#39;experimental_method&#39;):</span>
            <span class="n">entry_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_entry_info&#39;</span><span class="p">]</span>
            <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;experimental_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry_info</span><span class="p">[</span><span class="s1">&#39;experimental_method&#39;</span><span class="p">]</span>
            
            <span class="c1">#elif (attribute == &#39;resolution_combined&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_entry_info&#39;</span><span class="p">]</span>
                <span class="c1"># need to check if more than one value is ever reported</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;resolution_combined&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[</span><span class="s1">&#39;resolution_combined&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;resolution_combined&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>

            <span class="c1">#elif (attribute == &#39;pdbx_seq_one_letter_code_can&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">SEQ</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">entity_poly</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;entity_poly&#39;</span><span class="p">]</span>
                    <span class="n">SEQ</span> <span class="o">=</span> <span class="n">entity_poly</span><span class="p">[</span><span class="s1">&#39;pdbx_seq_one_letter_code_can&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_seq_one_letter_code_can&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">SEQ</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_seq_one_letter_code_can&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            <span class="c1">#elif (attribute == &#39;entity_beg_seq_id&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">entity_align</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_polymer_entity_align&#39;</span><span class="p">]</span>
                    <span class="n">middle</span> <span class="o">=</span> <span class="n">entity_align</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">aligned_info</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="s1">&#39;aligned_regions&#39;</span><span class="p">]</span>
                    <span class="n">middle2</span> <span class="o">=</span> <span class="n">aligned_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;entity_beg_seq_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">middle2</span><span class="p">[</span><span class="s1">&#39;entity_beg_seq_id&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;entity_beg_seq_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            <span class="c1">#elif (attribute == &#39;ref_beg_seq_id&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">entity_align</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_polymer_entity_align&#39;</span><span class="p">]</span>
                    <span class="n">middle</span> <span class="o">=</span> <span class="n">entity_align</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">aligned_info</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="s1">&#39;aligned_regions&#39;</span><span class="p">]</span>
                    <span class="n">middle2</span> <span class="o">=</span> <span class="n">aligned_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;ref_beg_seq_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">middle2</span><span class="p">[</span><span class="s1">&#39;ref_beg_seq_id&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;ref_beg_seq_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            <span class="c1">#elif (attribute == &#39;aligned_regions_length&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">entity_align</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_polymer_entity_align&#39;</span><span class="p">]</span>
                    <span class="n">middle</span> <span class="o">=</span> <span class="n">entity_align</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">aligned_info</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="s1">&#39;aligned_regions&#39;</span><span class="p">]</span>
                    <span class="n">middle2</span> <span class="o">=</span> <span class="n">aligned_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;aligned_regions_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">middle2</span><span class="p">[</span><span class="s1">&#39;length&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;aligned_regions_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            <span class="c1">#elif (attribute == &#39;pdbx_gene_src_scientific_name&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span>  <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">entity_src_gen</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;entity_src_gen&#39;</span><span class="p">]</span>
                    <span class="n">middle</span> <span class="o">=</span> <span class="n">entity_src_gen</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">species</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="s1">&#39;pdbx_gene_src_scientific_name&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_gene_src_scientific_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">species</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_gene_src_scientific_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>

            <span class="c1">#elif (attribute == &#39;mutations exist (Y/N)&#39;):</span>
            <span class="n">mutation_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">entity_poly</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;entity_poly&#39;</span><span class="p">]</span>
                <span class="n">mutation_count</span> <span class="o">=</span> <span class="n">entity_poly</span><span class="p">[</span><span class="s1">&#39;rcsb_mutation_count&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mutation_count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;mutations exist (Y/N)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;mutations exist (Y/N)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span>
                

            <span class="c1">#elif (attribute ==&#39;rcsb_mutation_count&#39;):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">entity_poly</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;entity_poly&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_mutation_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity_poly</span><span class="p">[</span><span class="s1">&#39;rcsb_mutation_count&#39;</span><span class="p">]</span>
            <span class="c1">#return mutation_count</span>
            
            <span class="c1">#elif (attribute ==&#39;modifications locations&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">locations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mod_locations</span><span class="p">(</span><span class="n">polymer_entity_id</span><span class="o">=</span><span class="n">polymer_entity_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;modifications locations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;modifications locations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;modifications locations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            

            <span class="c1">#elif (attribute ==&#39;modifications&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mod_types</span><span class="p">(</span><span class="n">polymer_entity_id</span><span class="o">=</span><span class="n">polymer_entity_id</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;modifications&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;modifications&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;modifications&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>   

           <span class="c1"># elif (attribute ==&#39;mutations locations&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">polymer_entity</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_polymer_entity&#39;</span><span class="p">]</span>
                    <span class="n">mutation</span> <span class="o">=</span> <span class="n">polymer_entity</span><span class="p">[</span><span class="s1">&#39;pdbx_mutation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span>
                    <span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mutation</span><span class="p">:</span>
                        <span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
                    <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;mutations locations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                 <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;mutations locations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            
            <span class="c1">#elif (attribute == &#39;pdbx_mutation joined&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">polymer_entity</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_polymer_entity&#39;</span><span class="p">]</span>
                    <span class="n">mutation</span> <span class="o">=</span> <span class="n">polymer_entity</span><span class="p">[</span><span class="s1">&#39;pdbx_mutation&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_mutation joined&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mutation</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_mutation joined&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N/A&#39;</span>
            
            <span class="c1">#elif (attribute ==&#39;deposit_date&#39;):</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_accession_info&#39;</span><span class="p">]</span>
            <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;deposit_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[</span><span class="s1">&#39;deposit_date&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span>            

            <span class="c1">#elif (attribute == &#39;audit_author_name&#39;): #fixed</span>
            <span class="n">AUTHORS_LIST</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">temp_authors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;audit_author&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">temp_authors</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">each</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">AUTHORS_LIST</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;audit_author_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">AUTHORS_LIST</span><span class="p">)</span>

            <span class="c1">#elif (attribute == &#39;title&#39;):</span>
            <span class="n">citation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_primary_citation&#39;</span><span class="p">]</span>
            <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">citation</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>

            <span class="c1">#elif (attribute ==&#39;pdbx_database_id_doi&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">citation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_primary_citation&#39;</span><span class="p">]</span>
                <span class="n">DOI</span> <span class="o">=</span> <span class="n">citation</span><span class="p">[</span><span class="s1">&#39;pdbx_database_id_doi&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_database_id_doi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DOI</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">citation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;citation&#39;</span><span class="p">]</span>
                    <span class="n">middle</span> <span class="o">=</span> <span class="n">citation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_database_id_doi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="s1">&#39;pdbx_database_id_doi&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_database_id_doi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            <span class="c1">#elif (attribute ==&#39;pdbx_database_id_pub_med&#39;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">citation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_primary_citation&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_database_id_pub_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">citation</span><span class="p">[</span><span class="s1">&#39;pdbx_database_id_pub_med&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">citation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;citation&#39;</span><span class="p">]</span>
                    <span class="n">middle</span> <span class="o">=</span> <span class="n">citation</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_database_id_pub_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">middle</span><span class="p">[</span><span class="s1">&#39;pdbx_database_id_PubMed&#39;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_database_id_pub_med&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not found&#39;</span>
            
            <span class="c1">#elif (attribute == &quot;pdbx_description&quot;):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polymer_entity_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">rcsb_polymer_entity</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_polymer_entity&#39;</span><span class="p">]</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rcsb_polymer_entity</span><span class="p">[</span><span class="s1">&#39;pdbx_description&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">anno_dict</span><span class="p">[</span><span class="s1">&#39;pdbx_description&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s1">&#39;N/A&#39;</span>

            <span class="k">return</span> <span class="n">anno_dict</span>


           
    
        <span class="k">def</span> <span class="nf">find_mods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polymer_entity_id</span><span class="p">):</span>
            <span class="n">polymer_entity_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overall_polymer_entity_dict</span><span class="p">[</span><span class="n">polymer_entity_id</span><span class="p">]</span>
            <span class="n">pdb_seq</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span><span class="p">[</span><span class="s1">&#39;entity_poly&#39;</span><span class="p">][</span><span class="s1">&#39;pdbx_seq_one_letter_code&#39;</span><span class="p">]</span>
            <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">mods</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">locs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">pdb_seq</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">pdb_seq</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">pdb_seq</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="n">pdb_seq</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">offset</span>
                <span class="n">mod_loc</span> <span class="o">=</span> <span class="n">mod</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
                <span class="n">mods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mod_loc</span><span class="p">)</span>
                <span class="n">locs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">loc</span><span class="p">))</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">end</span>
            <span class="k">return</span> <span class="n">mods</span><span class="p">,</span> <span class="n">locs</span>
    
        <span class="k">def</span> <span class="nf">get_mod_locations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polymer_entity_id</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">polymer_entity_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">:</span>
                <span class="n">locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="n">polymer_entity_id</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mods</span><span class="p">,</span> <span class="n">locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_mods</span><span class="p">(</span><span class="n">polymer_entity_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mods</span><span class="p">[</span><span class="n">polymer_entity_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">mods</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="n">polymer_entity_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">locs</span>
            <span class="k">return</span> <span class="n">locs</span>
        
        <span class="k">def</span> <span class="nf">get_mod_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polymer_entity_id</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">polymer_entity_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mods</span><span class="p">:</span>
                <span class="n">mods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mods</span><span class="p">[</span><span class="n">polymer_entity_id</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mods</span><span class="p">,</span> <span class="n">locs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_mods</span><span class="p">(</span><span class="n">polymer_entity_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mods</span><span class="p">[</span><span class="n">polymer_entity_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">mods</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">locs</span><span class="p">[</span><span class="n">polymer_entity_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">locs</span>                
            <span class="k">return</span> <span class="n">mods</span>

        <span class="k">def</span> <span class="nf">get_all_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Obtains information from the PDB API for a specific PDB ID and stores it in dictionaries.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            entry_dict : dictionary</span>
<span class="sd">                stores information from the entry service for the PDB_ID</span>
<span class="sd">            pubmed_dict : dictionary</span>
<span class="sd">                stores the pubmed annotations (data integrated from PubMed) for the PDB_ID</span>
<span class="sd">            schema_dict : dictionary</span>
<span class="sd">                stores information from the entry schema for the PDB_ID</span>
<span class="sd">            schema_uniprot_dict : dictionary</span>
<span class="sd">                stores information from the uniprot schema for the PDB_ID</span>
<span class="sd">            overall_polymer_entity_dict : dictionary</span>
<span class="sd">                stores polymer entity data for each entity id corresponding with the PDB_ID</span>

<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">PDB_ID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

            <span class="n">ERROR</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1">#check for repsonse issues, collecting errors and handling them</span>
            <span class="n">entry_url</span> <span class="o">=</span> <span class="s2">&quot;https://data.rcsb.org/rest/v1/core/entry/&quot;</span> <span class="o">+</span> <span class="n">PDB_ID</span>
            <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entry_url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1">#print(&#39;Failed to get %s from rcsb entry with code %s:&#39;%(PDB_ID, resp.status_code))</span>
                <span class="n">ERROR</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">entry_dict</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="c1">#THIS one is used!!</span>
        
                  
            <span class="n">entry_id_dict</span> <span class="o">=</span> <span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;entry&#39;</span><span class="p">]</span>
            <span class="n">ENTRY_ID</span> <span class="o">=</span> <span class="n">entry_id_dict</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">rcsb_entry_container_identifiers</span> <span class="o">=</span> <span class="n">entry_dict</span><span class="p">[</span><span class="s1">&#39;rcsb_entry_container_identifiers&#39;</span><span class="p">]</span>
            <span class="n">ENTITY_IDS</span> <span class="o">=</span> <span class="n">rcsb_entry_container_identifiers</span><span class="p">[</span><span class="s1">&#39;entity_ids&#39;</span><span class="p">]</span>
            <span class="n">polymer_entity_ids</span> <span class="o">=</span> <span class="n">rcsb_entry_container_identifiers</span><span class="p">[</span><span class="s1">&#39;polymer_entity_ids&#39;</span><span class="p">]</span>
            <span class="n">nonpolymer_entity_ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">ENTITY_IDS</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">each</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">polymer_entity_ids</span><span class="p">:</span>
                    <span class="n">nonpolymer_entity_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">each</span><span class="p">)</span>
        
            <span class="n">overall_polymer_entity_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">each_entity_id</span> <span class="ow">in</span> <span class="n">polymer_entity_ids</span><span class="p">:</span>
                <span class="n">polymer_entity_url</span> <span class="o">=</span> <span class="s2">&quot;https://data.rcsb.org/rest/v1/core/polymer_entity/&quot;</span> <span class="o">+</span> \
                    <span class="n">ENTRY_ID</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">each_entity_id</span>
                <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">polymer_entity_url</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="c1">#print(&#39;Failed to get %s from rcsb polymer entity with code %s:&#39;%(PDB_ID, resp.status_code))</span>
                    <span class="n">ERROR</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">polymer_entity_dict</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">overall_polymer_entity_dict</span><span class="p">[</span><span class="n">each_entity_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">polymer_entity_dict</span>
        
        
            <span class="k">return</span> <span class="n">entry_dict</span><span class="p">,</span> <span class="n">overall_polymer_entity_dict</span>

        
<div class="viewcode-block" id="generateStructureRefFile_fromUniprotFile">
<a class="viewcode-back" href="../../PDB.html#CoDIAC.PDB.generateStructureRefFile_fromUniprotFile">[docs]</a>
<span class="k">def</span> <span class="nf">generateStructureRefFile_fromUniprotFile</span><span class="p">(</span><span class="n">uniprotRefFile</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates a PDB Structure Reference File</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        uniprotRefFile: str</span>
<span class="sd">            Location of the uniprot referenct to use</span>
<span class="sd">        outputFile: str</span>
<span class="sd">            name of the output file</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        Writes to the outputFile location a CSV formatted, annotated structure file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#check that a uniprotRefFile exists</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">uniprotRefFile</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: </span><span class="si">%s</span><span class="s2"> cannot be found&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">uniprotRefFile</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="n">uniprot_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">uniprotRefFile</span><span class="p">)</span>
    <span class="n">PDB_IDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">uniprot_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">pdbs_col</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;PDB IDs&#39;</span><span class="p">]</span>
   
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pdbs_col</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">pdbs</span> <span class="o">=</span> <span class="n">pdbs_col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">pdb_id</span> <span class="ow">in</span> <span class="n">pdbs</span><span class="p">:</span>
                <span class="n">PDB_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pdb_id</span><span class="p">)</span>
    <span class="c1">#print(&quot;DEBUG: PDB IDs&quot;)</span>
    <span class="c1">#print(PDB_IDs)</span>
    <span class="n">generateStructureRefFile</span><span class="p">(</span><span class="n">PDB_IDs</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">)</span>    </div>


<span class="k">def</span> <span class="nf">progress_bar</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">bar_length</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">fraction</span> <span class="o">=</span> <span class="n">current</span> <span class="o">/</span> <span class="n">total</span>

    <span class="n">arrow</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fraction</span> <span class="o">*</span> <span class="n">bar_length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bar_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrow</span><span class="p">))</span> <span class="o">*</span> <span class="s1">&#39; &#39;</span>

    <span class="n">ending</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="n">total</span> <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Progress: [</span><span class="si">{</span><span class="n">arrow</span><span class="si">}{</span><span class="n">padding</span><span class="si">}</span><span class="s1">] </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">fraction</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">ending</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">generateStructureRefFile</span><span class="p">(</span><span class="n">PDB_IDs</span><span class="p">,</span> <span class="n">outputFile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates a PDB Structure Reference File</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        PDB_IDs : a list of PDB IDs</span>
<span class="sd">        outputFile : name of the output file</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        .csv Structure reference file with relevant metadata</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bad_PDBs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">PDB_ID</span> <span class="ow">in</span> <span class="n">PDB_IDs</span><span class="p">:</span>
        <span class="c1">#This can have a lot of fetching time, we would like to print to let the user</span>
        <span class="c1"># know what the status is of the job fetch. </span>
        <span class="n">progress_bar</span><span class="p">(</span><span class="n">PDB_IDs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">PDB_ID</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">PDB_IDs</span><span class="p">))</span>
        <span class="n">interface</span> <span class="o">=</span> <span class="n">PDB_interface</span><span class="p">(</span><span class="n">PDB_ID</span><span class="p">)</span>
        <span class="n">ERROR</span><span class="p">,</span> <span class="n">annotations</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">get_anno_dict</span><span class="p">()</span>
        <span class="c1"># reiteration attempt - in case of connectivity issue. </span>
        <span class="n">num_attempts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">while</span> <span class="n">ERROR</span> <span class="ow">and</span> <span class="n">num_attempts</span> <span class="o">&lt;</span> <span class="n">max_attempts</span><span class="p">:</span>
            <span class="n">ERROR</span><span class="p">,</span> <span class="n">annotations</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">get_anno_dict</span><span class="p">()</span>
            <span class="n">num_attempts</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ERROR</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">annotation</span> <span class="ow">in</span> <span class="n">annotations</span><span class="p">:</span> <span class="c1">#multiple entities can come back and each should become something in a dataframe</span>
                <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bad_PDBs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PDB_ID</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dict_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">COLUMNS</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Structure Reference File successfully created!&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bad_PDBs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All PDBs successfully fetched&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Could not fetch the following PDBs, these encountered errors, despite retrying </span><span class="si">%d</span><span class="s2"> times:&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">max_attempts</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">bad_PDBs</span><span class="p">)</span>
    <span class="c1">#interface.print_output_csv(outputFile)</span>
    <span class="k">return</span> <span class="n">dict_list</span><span class="p">,</span> <span class="n">bad_PDBs</span>
    
<span class="k">def</span> <span class="nf">download_cifFile</span><span class="p">(</span><span class="n">PDB_list</span><span class="p">,</span> <span class="n">PATH</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;generates .cif files for PDB structures</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        PDB_list : list of PDB IDs </span>
<span class="sd">        PATH : path to the store the .cif file</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        .cif files to the path specified&#39;&#39;&#39;</span>
    
    <span class="k">for</span> <span class="n">PDB_ID</span> <span class="ow">in</span> <span class="n">PDB_list</span><span class="p">:</span>
        
        <span class="n">response</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;https://files.rcsb.org/view/</span><span class="si">{</span><span class="n">PDB_ID</span><span class="si">}</span><span class="s1">.cif&#39;</span><span class="p">)</span>
        <span class="n">cif_path</span> <span class="o">=</span> <span class="n">PATH</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">PDB_ID</span><span class="o">+</span><span class="s1">&#39;.cif&#39;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cif_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">cif_path</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CoDIAC 1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">CoDIAC.PDB</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2023, Naegle Lab.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>